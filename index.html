<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> PICNIC DE GIRLS PRE CUMPLEA√ëOS MEL <3 </title>

<link href="https://fonts.googleapis.com/css2?family=Sour+Gummy:wght@400;600&family=Comic+Neue:wght@300;400&display=swap" rel="stylesheet">

<style>
/* -------- Pantalla de bloqueo -------- */
:root {
  --bg: #0a0a0f;
  --fg: #ffffff;
  --pink: #ffd6e7;
  --heart: #ff2b4f;
  --textGlow: 0 0 .6rem rgba(255, 214, 231, .9);
}

#passwordScreen {
  display: flex;
  height: 100vh;
  width: 100%;
  background-color: var(--bg);
  color: var(--fg);
  font-family: 'Sour Gummy', cursive;
}

.left { width: 40%; }
.left img {
  width: 100%;
  height: 100vh;
  object-fit: cover;
}

.right {
  width: 60%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background-color: #1a0013;
  color: var(--pink);
  text-align: center;
}

.right h2 {
  font-size: 2.2em;
  text-shadow: var(--textGlow);
  margin-bottom: 1em;
}
.right input {
  padding: 0.7em 1em;
  border-radius: 12px;
  border: none;
  outline: none;
  text-align: center;
  font-size: 1em;
  width: 220px;
  margin-bottom: 1em;
  background-color: #2a0020;
  color: var(--pink);
}
.right button {
  background-color: var(--heart);
  border: none;
  color: white;
  font-size: 1em;
  padding: 8px 18px;
  border-radius: 12px;
  cursor: pointer;
}
#errorText { color: #ffbaba; margin-top: 1em; display: none; }

/* -------- P√°gina rosada -------- */
body {
  margin: 0;
  background-color: #ffe6f2;
  font-family: "Comic Neue", cursive;
  color: #b30059;
  text-align: center;
}

#mainContent { display: none; padding: 30px; }
h1 { font-size: 2.3em; color: #cc0066; }

/* Caja de mensajes */
.mensaje-box {
  background-color: white;
  width: 85%;
  max-width: 650px;
  margin: 25px auto;
  padding: 20px;
  border-radius: 15px;
}

input, textarea {
  width: 90%;
  padding: 10px;
  margin: 10px 0;
  border: 2px solid #f7a8c0;
  border-radius: 10px;
  background-color: #fff8fb;
}

button {
  background-color: #ff99cc;
  border: none;
  padding: 8px 18px;
  border-radius: 10px;
  color: white;
}
button:hover { background-color: #ff66b2; }

#subirFotoLabel {
  display: inline-block;
  background-color: #ff7ebf;
  color: white;
  padding: 8px 18px;
  border-radius: 10px;
  cursor: pointer;
}
#foto { display:none; }

.mensaje {
  background-color: #fff0f6;
  border-radius: 15px;
  padding: 15px;
  margin: 15px auto;
  width: 80%;
  max-width: 650px;
}
.mensaje h3 { color:#cc0066; }

/* Carrusel */
.carrusel {
  width: 280px;
  height: 180px;
  margin: 0 auto 25px;
  position: relative;
  border-radius: 15px;
  overflow: hidden;
}
.carrusel img { width:100%; height:100%; object-fit:cover; display:none; }
.carrusel img.active { display:block; }

/* Flechas carrusel */
.flecha {
  position:absolute;
  top:50%; transform:translateY(-50%);
  background:rgba(255,182,193,0.6);
  border:none;
  color:#fff;
  font-size:1.6em;
  padding:4px 8px;
  border-radius:50%;
}
.flecha.izq { left:8px; }
.flecha.der { right:8px; }

/* Corazones */
.corazon {
  position: fixed;
  bottom: -10px;
  color: rgba(255, 105, 180, 0.5);
  font-size: 16px;
  animation: flotar 6s linear infinite;
}
@keyframes flotar {
  0% { transform: translateY(0); opacity:0.7; }
  100% { transform: translateY(-110vh); opacity:0; }
}
</style>
</head>

<body>

<!-- PANTALLA PASSWORD -->
<div id="passwordScreen">
  <div class="left">
    <img src="https://files.catbox.moe/opg5vs.jpeg">
  </div>
  <div class="right">
    <h2> PICNIC DE GIRLS PRE CUMPLEA√ëOS MEL <3 </h2>
    <input type="password" id="passwordInput" placeholder="Contrase√±a...">
    <button onclick="checkPassword()">Entrar üíñ</button>
    <p id="errorText">üíî Clave incorrecta üíî</p>
  </div>
</div>

<!-- CONTENIDO -->
<div id="mainContent">
  <h1> PALABRAS LINDAS PARA LA CUMPLEA√ëERA <3 </h1>

  <div class="carrusel" id="carrusel" style="display:none;">
    <button class="flecha izq" onclick="moverCarrusel(-1)">‚ùÆ</button>
    <button class="flecha der" onclick="moverCarrusel(1)">‚ùØ</button>
  </div>

  <div class="mensaje-box">
    <h3>Escribe tu mensaje para Mel</h3>
    <input id="nombre" placeholder="Tu nombre...">
    <textarea id="mensaje" rows="4" placeholder="Escribe algo bonito..."></textarea>
    <label id="subirFotoLabel" for="foto">A√±ade tu recuerdo fav üì∏</label>
    <input type="file" id="foto" accept="image/*">
    <button onclick="agregarMensaje()">Guardar mensaje üíå</button>
  </div>

  <div id="mensajes"></div>
</div>

<!-- FIREBASE SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, orderBy, query } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDdliDwEBGd7nNs4_qLX1GFYA_k51N9_lw",
  authDomain: "picnic-mel.firebaseapp.com",
  projectId: "picnic-mel",
  storageBucket: "picnic-mel.firebasestorage.app",
  messagingSenderId: "947882543668",
  appId: "1:947882543668:web:3ac7d55ff179ab60b19861",
  measurementId: "G-WEKRG4FB3B"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// -------- FUNCIONES --------

// Password
window.checkPassword = function () {
  const input = document.getElementById("passwordInput").value.toLowerCase().trim();
  if (input === "mel") {
    document.getElementById("passwordScreen").style.display = "none";
    document.getElementById("mainContent").style.display = "block";
    mostrarMensajes();
    iniciarCorazones();
  } else document.getElementById("errorText").style.display = "block";
};

// Guardar en Firebase
window.agregarMensaje = async function () {
  const nombre = document.getElementById("nombre").value.trim();
  const mensaje = document.getElementById("mensaje").value.trim();
  const foto = document.getElementById("foto").files[0];

  if (!nombre || !mensaje) return alert("Completa nombre y mensaje");

  let fotoURL = null;

  if (foto) {
    const storageRef = ref(storage, "fotos/" + Date.now() + "_" + foto.name);
    await uploadBytes(storageRef, foto);
    fotoURL = await getDownloadURL(storageRef);
  }

  await addDoc(collection(db, "mensajes"), {
    nombre,
    mensaje,
    imagen: fotoURL,
    fecha: Date.now()
  });

  document.getElementById("nombre").value = "";
  document.getElementById("mensaje").value = "";
  document.getElementById("foto").value = "";

  mostrarMensajes();
};

// Mostrar mensajes
async function mostrarMensajes() {
  const cont = document.getElementById("mensajes");
  cont.innerHTML = "";

  const q = query(collection(db, "mensajes"), orderBy("fecha", "desc"));
  const snapshot = await getDocs(q);

  const fotos = [];

  snapshot.forEach(docSnap => {
    const m = docSnap.data();
    const id = docSnap.id;

    if (m.imagen) fotos.push(m.imagen);

    const div = document.createElement("div");
    div.className = "mensaje";
    div.innerHTML = `
      <h3>${m.nombre} üíï</h3>
      <p>${m.mensaje}</p>
      ${m.imagen ? `<img src="${m.imagen}" style="max-width:100%; border-radius:10px;">` : ""}
      <button onclick="editarMensaje('${id}', '${m.mensaje.replace(/'/g,"&#39;")}')">Editar</button>
      <button onclick="borrarMensaje('${id}')">Borrar</button>
    `;
    cont.appendChild(div);
  });

  actualizarCarrusel(fotos);
}

// Editar
window.editarMensaje = async function (id, mensajeActual) {
  const nuevo = prompt("Edita el mensaje:", mensajeActual);
  if (!nuevo) return;

  const refDoc = doc(db, "mensajes", id);
  await updateDoc(refDoc, { mensaje: nuevo });

  mostrarMensajes();
};

// Borrar
window.borrarMensaje = async function (id) {
  if (!confirm("¬øBorrar mensaje?")) return;

  const refDoc = doc(db, "mensajes", id);
  await deleteDoc(refDoc);

  mostrarMensajes();
};

// Carrusel
let indiceCarrusel = 0;
function actualizarCarrusel(fotos) {
  const cont = document.getElementById("carrusel");
  cont.innerHTML = `
    <button class='flecha izq' onclick='moverCarrusel(-1)'>‚ùÆ</button>
    <button class='flecha der' onclick='moverCarrusel(1)'>‚ùØ</button>
  `;

  if (fotos.length === 0) {
    cont.style.display = "none";
    return;
  }

  fotos.forEach((url, i) => {
    const img = document.createElement("img");
    img.src = url;
    if (i === 0) img.classList.add("active");
    cont.appendChild(img);
  });

  cont.style.display = "block";
}

window.moverCarrusel = function (dir) {
  const imgs = document.querySelectorAll(".carrusel img");
  if (!imgs.length) return;

  imgs[indiceCarrusel].classList.remove("active");
  indiceCarrusel = (indiceCarrusel + dir + imgs.length) % imgs.length;
  imgs[indiceCarrusel].classList.add("active");
};

// Corazoncitos
function iniciarCorazones() {
  setInterval(() => {
    const c = document.createElement("div");
    c.classList.add("corazon");
    c.textContent = "üíñ";
    c.style.left = Math.random()*100 + "vw";
    c.style.fontSize = (12 + Math.random()*10) + "px";
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 6000);
  }, 400);
}

</script>

</body>
</html>

